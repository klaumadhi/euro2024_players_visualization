{"version":3,"file":"zero-md.legacy.min.js","sources":["../src/index.js"],"sourcesContent":["export class ZeroMd extends HTMLElement {\n  get src() {\n    return this.getAttribute('src')\n  }\n\n  set src(val) {\n    this.reflect('src', val)\n  }\n\n  get manualRender() {\n    return this.hasAttribute('manual-render')\n  }\n\n  set manualRender(val) {\n    this.reflect('manual-render', val)\n  }\n\n  reflect(name, val) {\n    if (val === false) {\n      this.removeAttribute(name)\n    } else {\n      this.setAttribute(name, val === true ? '' : val)\n    }\n  }\n\n  static get observedAttributes() {\n    return ['src']\n  }\n\n  attributeChangedCallback(name, old, val) {\n    if (name === 'src' && this.connected && !this.manualRender && val !== old) {\n      this.render()\n    }\n  }\n\n  constructor(defaults) {\n    super()\n    this.version = '$VERSION'\n    this.config = {\n      markedUrl: 'https://cdn.jsdelivr.net/gh/markedjs/marked@4/marked.min.js',\n      prismUrl: [\n        ['https://cdn.jsdelivr.net/gh/PrismJS/prism@1/prism.min.js', 'data-manual'],\n        'https://cdn.jsdelivr.net/gh/PrismJS/prism@1/plugins/autoloader/prism-autoloader.min.js'\n      ],\n      cssUrls: [\n        'https://cdn.jsdelivr.net/gh/sindresorhus/github-markdown-css@4/github-markdown.min.css',\n        'https://cdn.jsdelivr.net/gh/PrismJS/prism@1/themes/prism.min.css'\n      ],\n      hostCss:\n        ':host{display:block;position:relative;contain:content;}:host([hidden]){display:none;}',\n      ...defaults,\n      ...window.ZeroMdConfig\n    }\n    this.root = this.hasAttribute('no-shadow') ? this : this.attachShadow({ mode: 'open' })\n    this.root.prepend(\n      ...this.makeNodes(`<div class=\"markdown-styles\"></div><div class=\"markdown-body\"></div>`)\n    )\n    if (!this.constructor.ready) {\n      this.constructor.ready = Promise.all([\n        !!window.marked || this.loadScript(this.config.markedUrl),\n        !!window.Prism || this.loadScript(this.config.prismUrl)\n      ])\n    }\n    this.clicked = this.clicked.bind(this)\n    if (!this.manualRender) {\n      // Scroll to hash id after first render. However, `history.scrollRestoration` inteferes with this\n      // on refresh. It's much better to use a `setTimeout` rather than to alter the browser's behaviour.\n      this.render().then(() => setTimeout(() => this.goto(location.hash), 250))\n    }\n    this.observer = new MutationObserver(() => {\n      this.observeChanges()\n      if (!this.manualRender) this.render()\n    })\n    this.observer.observe(this, { childList: true })\n    this.observeChanges()\n  }\n\n  /**\n   * Start observing changes, if not already so, in `template` and `script`.\n   */\n  observeChanges() {\n    this.querySelectorAll('template,script[type=\"text/markdown\"]').forEach((n) => {\n      this.observer.observe(n.content || n, {\n        childList: true,\n        subtree: true,\n        attributes: true,\n        characterData: true\n      })\n    })\n  }\n\n  connectedCallback() {\n    this.connected = true\n    this.fire('zero-md-connected', {}, { bubbles: false, composed: false })\n    this.waitForReady().then(() => {\n      this.fire('zero-md-ready')\n    })\n    if (this.shadowRoot) {\n      this.shadowRoot.addEventListener('click', this.clicked)\n    }\n  }\n\n  disconnectedCallback() {\n    this.connected = false\n    if (this.shadowRoot) {\n      this.shadowRoot.removeEventListener('click', this.clicked)\n    }\n  }\n\n  waitForReady() {\n    const ready =\n      this.connected ||\n      new Promise((resolve) => {\n        this.addEventListener('zero-md-connected', function handler() {\n          this.removeEventListener('zero-md-connected', handler)\n          resolve()\n        })\n      })\n    return Promise.all([this.constructor.ready, ready])\n  }\n\n  fire(name, detail = {}, opts = { bubbles: true, composed: true }) {\n    if (detail.msg) {\n      console.warn(detail.msg)\n    }\n    this.dispatchEvent(\n      new CustomEvent(name, {\n        detail: { node: this, ...detail },\n        ...opts\n      })\n    )\n  }\n\n  tick() {\n    return new Promise((resolve) => requestAnimationFrame(resolve))\n  }\n\n  // Coerce anything into an array\n  arrify(any) {\n    return any ? (Array.isArray(any) ? any : [any]) : []\n  }\n\n  // Promisify an element's onload callback\n  onload(node) {\n    return new Promise((resolve, reject) => {\n      node.onload = resolve\n      node.onerror = (err) => reject(err.path ? err.path[0] : err.composedPath()[0])\n    })\n  }\n\n  // Load a url or load (in order) an array of urls via <script> tags\n  loadScript(urls) {\n    return Promise.all(\n      this.arrify(urls).map((item) => {\n        const [url, ...attrs] = this.arrify(item)\n        const el = document.createElement('script')\n        el.src = url\n        el.async = false\n        attrs.forEach((attr) => el.setAttribute(attr, ''))\n        return this.onload(document.head.appendChild(el))\n      })\n    )\n  }\n\n  // Scroll to selected element\n  goto(sel) {\n    let el\n    try {\n      el = this.root.querySelector(sel)\n    } catch {}\n    if (el) el.scrollIntoView()\n  }\n\n  // Hijack same-doc anchor hash links\n  clicked(ev) {\n    if (ev.metaKey || ev.ctrlKey || ev.altKey || ev.shiftKey || ev.defaultPrevented) {\n      return\n    }\n    const a = ev.target.closest('a')\n    if (a && a.hash && a.host === location.host && a.pathname === location.pathname) {\n      this.goto(a.hash)\n    }\n  }\n\n  dedent(str) {\n    str = str.replace(/^\\n/, '')\n    const match = str.match(/^\\s+/)\n    return match ? str.replace(new RegExp(`^${match[0]}`, 'gm'), '') : str\n  }\n\n  getBaseUrl(src) {\n    const a = document.createElement('a')\n    a.href = src\n    return a.href.substring(0, a.href.lastIndexOf('/') + 1)\n  }\n\n  // Runs Prism highlight async; falls back to sync if Web Workers throw\n  highlight(container) {\n    return new Promise((resolve) => {\n      const unhinted = container.querySelectorAll('pre>code:not([class*=\"language-\"])')\n      unhinted.forEach((n) => {\n        // Dead simple language detection :)\n        const lang = n.innerText.match(/^\\s*</)\n          ? 'markup'\n          : n.innerText.match(/^\\s*(\\$|#)/)\n            ? 'bash'\n            : 'js'\n        n.classList.add(`language-${lang}`)\n      })\n      try {\n        window.Prism.highlightAllUnder(container, true, resolve())\n      } catch {\n        window.Prism.highlightAllUnder(container)\n        resolve()\n      }\n    })\n  }\n\n  /**\n   * Converts HTML string into HTMLCollection of nodes\n   * @param {string} html\n   * @returns {HTMLCollection}\n   */\n  makeNodes(html) {\n    const tpl = document.createElement('template')\n    tpl.innerHTML = html\n    return tpl.content.children\n  }\n\n  /**\n   * Constructs the styles dom and returns HTML string\n   * @returns {string} `markdown-styles` string\n   */\n  buildStyles() {\n    const get = (query) => {\n      const node = this.querySelector(query)\n      return node ? node.innerHTML || ' ' : ''\n    }\n    const urls = this.arrify(this.config.cssUrls)\n    const html = `<style>${this.config.hostCss}</style>${get('template[data-merge=\"prepend\"]')}${\n      get('template:not([data-merge])') ||\n      urls.reduce((a, c) => `${a}<link rel=\"stylesheet\" href=\"${c}\">`, '')\n    }${get('template[data-merge=\"append\"]')}`\n    return html\n  }\n\n  /**\n   * Constructs the markdown body nodes and returns HTML string\n   * @param {*} opts Markedjs options\n   * @returns {Promise<string>} `markdown-body` string\n   */\n  async buildMd(opts = {}) {\n    const src = async () => {\n      if (!this.src) return ''\n      const resp = await fetch(this.src)\n      if (resp.ok) {\n        const md = await resp.text()\n        return window.marked.parse(md, {\n          baseUrl: this.getBaseUrl(this.src),\n          ...opts\n        })\n      } else {\n        this.fire('zero-md-error', {\n          msg: `[zero-md] HTTP error ${resp.status} while fetching src`,\n          status: resp.status,\n          src: this.src\n        })\n        return ''\n      }\n    }\n    const script = () => {\n      const el = this.querySelector('script[type=\"text/markdown\"]')\n      if (!el) return ''\n      const md = el.hasAttribute('data-dedent') ? this.dedent(el.text) : el.text\n      return window.marked.parse(md, opts)\n    }\n    return (await src()) || script()\n  }\n\n  /**\n   * Returns 32-bit DJB2a hash in base36\n   * @param {string} str\n   * @returns {string}\n   */\n  getHash(str) {\n    let hash = 5381\n    for (let index = 0; index < str.length; index++) {\n      hash = ((hash << 5) + hash) ^ str.charCodeAt(index)\n    }\n    return (hash >>> 0).toString(36)\n  }\n\n  /**\n   * Insert or replace styles node in root from a HTML string. If there are external stylesheet\n   * links, wait for them to load.\n   * @param {string} html styles string\n   * @returns {Promise<boolean|undefined>} returns true if stamped\n   */\n  async stampStyles(html) {\n    const hash = this.getHash(html)\n    const target = this.root.querySelector('.markdown-styles')\n    if (target.getAttribute('data-hash') !== hash) {\n      target.setAttribute('data-hash', hash)\n      const nodes = this.makeNodes(html)\n      const links = [...nodes].filter(\n        (i) => i.tagName === 'LINK' && i.getAttribute('rel') === 'stylesheet'\n      )\n      target.innerHTML = ''\n      target.append(...nodes)\n      await Promise.all(links.map((l) => this.onload(l))).catch((err) => {\n        this.fire('zero-md-error', {\n          msg: '[zero-md] An external stylesheet failed to load',\n          status: undefined,\n          src: err.href\n        })\n      })\n      return true\n    }\n  }\n\n  /**\n   * Insert or replace HTML body string into DOM\n   * @param {string} html markdown-body string\n   * @param {string[]} [classes] list of classes to apply to `.markdown-body` wrapper\n   * @returns {Promise<boolean|undefined>} returns true if stamped\n   */\n  async stampBody(html, classes) {\n    const names = this.arrify(classes)\n    const hash = this.getHash(html + JSON.stringify(names))\n    const target = this.root.querySelector('.markdown-body')\n    if (target.getAttribute('data-hash') !== hash) {\n      target.setAttribute('data-hash', hash)\n      names.unshift('markdown-body')\n      target.setAttribute('class', names.join(' '))\n      const nodes = this.makeNodes(html)\n      target.innerHTML = ''\n      target.append(...nodes)\n      await this.highlight(target)\n      return true\n    }\n  }\n\n  async render(opts = {}) {\n    await this.waitForReady()\n    const pending = this.buildMd(opts)\n    const styles = await this.stampStyles(this.buildStyles())\n    await this.tick()\n    const body = await this.stampBody(await pending, opts.classes)\n    this.fire('zero-md-rendered', { node: this, stamped: { styles, body } })\n  }\n}\n\ncustomElements.define('zero-md', ZeroMd)\n"],"names":["ZeroMd","_HTMLElement","defaults","_this$root","_this","_classCallCheck","_callSuper","this","version","config","_objectSpread","markedUrl","prismUrl","cssUrls","hostCss","window","ZeroMdConfig","root","hasAttribute","_assertThisInitialized","attachShadow","mode","prepend","apply","_toConsumableArray","makeNodes","constructor","ready","Promise","all","marked","loadScript","Prism","clicked","bind","manualRender","render","then","setTimeout","goto","location","hash","observer","MutationObserver","observeChanges","observe","childList","_render","_stampBody","_stampStyles","_buildMd","_inherits","key","get","getAttribute","set","val","reflect","value","name","removeAttribute","setAttribute","old","connected","_this2","querySelectorAll","forEach","n","content","subtree","attributes","characterData","_this3","fire","bubbles","composed","waitForReady","shadowRoot","addEventListener","removeEventListener","_this4","resolve","handler","detail","arguments","length","undefined","opts","msg","console","warn","dispatchEvent","CustomEvent","node","requestAnimationFrame","any","Array","isArray","reject","onload","onerror","err","path","composedPath","urls","_this5","arrify","map","item","_this5$arrify2","_toArray","url","attrs","slice","el","document","createElement","src","async","attr","head","appendChild","sel","querySelector","_unused","scrollIntoView","ev","metaKey","ctrlKey","altKey","shiftKey","defaultPrevented","a","target","closest","host","pathname","str","match","replace","RegExp","concat","href","substring","lastIndexOf","container","lang","innerText","classList","add","highlightAllUnder","_unused2","html","tpl","innerHTML","children","_this6","query","reduce","c","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","script","_this7","_args2","wrap","_context2","prev","next","_ref","_callee","resp","md","_context","abrupt","fetch","sent","ok","text","parse","baseUrl","getBaseUrl","status","stop","dedent","t0","index","charCodeAt","toString","_callee3","nodes","links","_this8","_context3","getHash","filter","i","tagName","append","l","catch","_x","_callee4","classes","names","_context4","JSON","stringify","unshift","join","highlight","_x2","_x3","_callee5","pending","styles","body","_args5","_context5","buildMd","stampStyles","buildStyles","tick","t1","t2","stampBody","call","stamped","_wrapNativeSuper","HTMLElement","customElements","define"],"mappings":"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"}